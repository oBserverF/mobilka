# Blueprint: Meditation Harmony App

## 1. Обзор проекта

**Цель:** Разработка кросс-платформенного мобильного приложения для медитации "Meditation Harmony". Приложение поможет пользователям расслабляться, снижать стресс и улучшать концентрацию с помощью аудиогидов, фоновой музыки и интерактивных упражнений.

**Технологический стек:**
- **Frontend:** Flutter
- **Backend:** Node.js (согласно ТЗ)
- **База данных и Аутентификация:** Будет определено позже (например, Firebase или собственное решение).

## 2. Реализованные стили, дизайны и функции

### Версия 0.1

- **Начальная структура проекта:** Создан базовый проект Flutter.
- **Навигация:** Реализована основная навигация с помощью `BottomNavigationBar`.
- **Экраны:** Созданы файлы-заглушки для `home_screen.dart`, `meditations_screen.dart`, `library_screen.dart`, `profile_screen.dart`.
- **Тема:** Настроена базовая тема приложения (`ThemeData`) в минималистичном стиле.

### Версия 0.2

- **Управление состоянием:** Интегрирован пакет `flutter_hooks`.
- **Архитектура:** Создан сервисный слой (`MeditationService`) и модель данных (`Meditation`) для управления данными.
- **Экран "Медитации":** Экран преобразован в `HookWidget` для асинхронной загрузки и отображения списка медитаций с обработкой состояний загрузки и ошибок.

### Версия 0.3

- **Архитектура управления состоянием:**
    - Добавлена зависимость `provider`.
    - Создана модель `Music`, сервис `MusicService` и провайдер `MusicProvider` для управления выбором фоновой музыки.
    - Приложение обернуто в `ChangeNotifierProvider` для глобального доступа к `MusicProvider`.
- **Экран "Библиотека":**
    - Реализован экран для выбора фоновой музыки из списка.
    - Выбранная музыка сохраняется в `MusicProvider`.
- **Рефакторинг `MeditationPlayerScreen`:**
    - Удалена локальная логика выбора фоновой музыки.
    - Экран теперь получает информацию о выбранном треке из `MusicProvider`.

### Версия 0.4 (Текущая)

- **Улучшенный UX запуска медитации:**
    - **Модальное окно:** При выборе медитации появляется модальное окно `MeditationStartSheet` для настройки длительности таймера.
    - **Автоматический запуск:** Плеер `MeditationPlayerScreen` теперь принимает заданную длительность, автоматически запускает воспроизведение медитации и фоновой музыки при открытии.
- **Обновленная библиотека музыки:**
    - **Премиум-контент:** В модель `Music` добавлено поле `isPremium`.
    - **UI Библиотеки:** Экран `LibraryScreen` теперь визуально разделяет доступные и "премиум" (заблокированные) треки. Пользователь не может выбрать премиум-треки, но видит их в списке.
- **Рефакторинг:**
    - **`MeditationsScreen`:** Логика нажатия изменена для вызова модального окна.
    - **`MeditationPlayerScreen`:** Переработан для приема `duration` и автозапуска.

## 3. План текущих изменений (Выполнено)

**Задача:** Реализовать более продуманный и интерактивный процесс запуска медитации и улучшить библиотеку музыки.

**Шаги:**

1.  **Обновить модель `Music`:** Добавить поле `isPremium`. (Выполнено)
2.  **Обновить `MusicService`:** Скорректировать сервис для возврата музыки с новым статусом. (Выполнено)
3.  **Переработать `LibraryScreen`:** Изменить UI для отображения заблокированных треков. (Выполнено)
4.  **Создать `MeditationStartSheet`:** Разработать модальное окно для настройки таймера. (Выполнено)
5.  **Обновить `MeditationsScreen`:** Изменить логику нажатия для открытия модального окна. (Выполнено)
6.  **Рефакторинг `MeditationPlayerScreen`:** Переделать плеер для автоматического запуска. (Выполнено)
7.  **Обновить `blueprint.md`:** Задокументировать все изменения. (Выполнено)
